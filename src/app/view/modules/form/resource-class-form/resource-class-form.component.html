<!-- this form has a multi-step form interface
    it will be displayed in dialog card box -->

<!-- the dialog title is always the same; It stays fixed to the top of the dialog -->
<md-toolbar md-dialog-title>

    <salsah-progress-stepper *ngIf="steps || max_steps" [steps]="steps" [counter]="counter"></salsah-progress-stepper>

</md-toolbar>

<!-- the sub forms of the main form are in th dialog content area; the content will change, step by step -->
<div md-dialog-content>
    <form #rcf="ngForm" (ngSubmit)="onSubmit(rcf.value, rcf.valid)" class="salsah-form">
        <!-- Step 1: Select resource type from a list of resources taken directly from the Knora base ontology (How do we include other ontologies / other properties? Do we simply read all possible resources within all ontologies?) -->
        <section [hidden]="counter!==0">
        <h3>Select your media file type</h3>
            <md-grid-list cols="3" gutterSize="12px" rowHeight="100px" class="form-grid">
                <md-grid-tile *ngFor="let item of knoraBase?.resourceClasses | key; let i = index;">
                    <button md-button (click)="nextFormSection(counter, $event, rcf.value, item.key)">
                        <md-icon style="font-size: 48px; width:48px; height: 48px;">{{item.value.icon}}</md-icon><br>
                        {{item.value.label}}
                    </button>
                </md-grid-tile>
            </md-grid-list>
        </section>
        <!-- Step 2: Select the properties you need that correspond to your resource (how about adding properties from other resources? Go to advanced? -->
        <section *ngIf="newResource.id" [hidden]="counter!==1">
            <h3>Select properties for {{knoraBase?.resourceClasses[newResource.id]?.label}}</h3>
            <md-list>
                <md-list-item *ngFor="let prop of newResource.properties | key; let i = index" class="link highlight">
                    <div class="salsah-checkbox">
                        <input type="checkbox"
                               [id]="prop.key"
                               [value]="prop.key"
                               [checked]="prop.value"
                               (change)="setProp(prop.key, prop.value, $event)">
                        <label [for]="prop.key" class="fill-remaining-space" [class.checked]="props[prop.key]">
                            <span class="checkbox-fake"></span>
                            <span class="checkbox-label">{{prop.value.label}}</span>
                        </label>
                    </div>

                    <!--
                    <md-checkbox *ngIf="prop.value.cardinality === '1' || prop.value.cardinality === '1-n'"
                                 [id]="prop.key"
                                 [ngModel]="prop.key"
                                 [checked]="true"
                                 [name]="'prop_' + i">
                        <label [for]="prop.key" class="full-width">{{prop.value.label}}<span ></span></label>
                    </md-checkbox>

                    <md-checkbox *ngIf="prop.value.cardinality === '0-1' || prop.value.cardinality === '0-n' || prop.value.cardinality === false"
                                 color="primary"
                                 [ngModel]="prop.key"
                                 [checked]="false"
                                 [name]="'prop_' + i">
                        {{prop.value.label}}
                    </md-checkbox>
                    -->
                    <!-- the properties on the left side are followed by their cardinality settings on the right side -->

                    <md-select *ngIf="props[prop.key] !== undefined" [(ngModel)]="prop.value.cardinality" [name]="prop.key">
                        <md-option *ngFor="let item of cardinalityList;" [value]="item">
                            {{item}}
                        </md-option>
                    </md-select>

                </md-list-item>
            </md-list>
        </section>
        <!-- Step 3: Confirm your selection -->
        <section [hidden]="counter!==2">
            <h3>Set the permissions for these properties</h3>
            <p *ngFor="let prop of props | key">
                <span *ngIf="props[prop.key] !== undefined">
                    ({{prop.value.cardinality}}) <strong>{{prop.value.label}}</strong>
                </span>
            </p>
            <div *ngFor="let res of knoraBase?.resourcetypes">
                <div *ngIf="res.label==newResource">
                    <i>Resource type:</i>
                    <br>
                    <b>{{res.label}}</b>
                    <br><br>
                    <i>Resource properties:</i>
                    <div *ngFor="let props of res.properties" >
                        <div *ngIf="props.checked==true || props.cardinality=='1' || props.cardinality=='1 - n'">
                            <b> {{props.label}} </b>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 4: Set permissions for each property -->
        <section [hidden]="counter!==3">
            <h3>Set property permissions and occurrence</h3>
            <div *ngFor="let res of knoraBase?.resourcetypes">
                <div *ngIf="res.label==newResource">
                    <div *ngFor="let props of res.properties">
                        <div *ngIf="props.checked==true || props.cardinality=='1' || props.cardinality=='1 - n'">
                            <table class="perm-style">
                                <tr>
                                    <!-- Property label -->
                                    <td width="150px">
                                        <div><b> {{props.label}} </b> <br></div>
                                        <!--<small><small>(occurrence: {{props.cardinality}})</small></small>-->
                                    </td>
                                    <!-- Permissions setting -->
                                    <td width="150px">
                                        <md-select class="perm-style"
                                                   placeholder="Permissions"
                                                   required
                                                   [(ngModel)]="perms[0].label" [name]="props.label" #permis="ngModel"  selected="group 1">
                                            <md-option *ngFor="let perm of perms; let first of first" [value]="perm.label">
                                                {{perm.label}}
                                            </md-option>
                                        </md-select>
                                        <div [hidden]="permis.valid" class="alert alert-danger">
                                            <small><small>Permissions are required</small></small>
                                        </div>
                                    </td>
                                    <!-- Occurrence setting -->
                                    <td width="150px">
                                        <md-select class="perm-style"
                                                   placeholder="{{props.cardinality}}"
                                                   required
                                                   [(ngModel)]="props.card" [name]="props.id" #cardis="ngModel">
                                            <md-option *ngFor="let card of cardinality; let first=first" [value]="card.label" selected="card.label === '1 - n' ? true : (card.label === '1' ? true : false)">
                                                {{card.label}}
                                            </md-option>
                                        </md-select>
                                        <div [hidden]="cardis.valid" class="alert alert-danger">
                                            <small><small>Occurrence is required</small></small>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Step 5: Make a comment and save -->
        <section [hidden]="counter!==4">
            <h3>Comments</h3>
            <md-input-container class="full-width">
                    <textarea mdInput placeholder="Comments" rows="8" name="userComments"
                              ngModel></textarea>
            </md-input-container>
        </section>
    </form>
</div>



<!-- the dialog actions bar is always the same; It stays fixed to the bottom of the dialog -->
<md-toolbar md-dialog-actions class="transparent">
    <button md-button
            md-dialog-close
            class="cancel-button">
        Cancel
    </button>
    <span class="fill-remaining-space"></span>

    <span class="back">
        <button md-button
                *ngIf="counter < max_steps && counter > 0"
                class="back-button"
                (click)="prevFormSection(counter, $event)">
            <md-icon>keyboard_arrow_left</md-icon> Back
        </button>
    </span>

    <!-- a button to go forward is on the right side; at the end it will be replaced with the submit button -->
    <span class="next">
        <button md-button
                *ngIf="counter < (max_steps - 1) && counter > 0"
                class="next-button md-primary"
                (click)="nextFormSection(counter, $event, rcf.value)">
            Next <md-icon>keyboard_arrow_right</md-icon>
        </button>
        <!-- or -->
        <button type="submit"
                md-raised-button
                *ngIf="counter === (max_steps - 1)"
                class="save-button mat-primary"
                (click)="onSubmit(rcf.value)"
                [disabled]="!rcf.valid">
            Save
        </button>
    </span>

</md-toolbar>


